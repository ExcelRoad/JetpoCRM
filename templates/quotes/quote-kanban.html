{% extends 'base/base_layout.html' %}
{% load static %}
{% load humanize %}

{% block breadcrumbs %}
    <a href="{% url 'homePage' %}">
        בית
    </a>
    <p class="flex items-center gap-1">
        <svg class="size-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 19.2857L15.8 21L20 17M16.5 14.4018C16.2052 14.2315 15.8784 14.1098 15.5303 14.0472C15.4548 14.0337 15.3748 14.024 15.2842 14.0171C15.059 14 14.9464 13.9915 14.7961 14.0027C14.6399 14.0143 14.5527 14.0297 14.4019 14.0723C14.2569 14.1132 13.9957 14.2315 13.4732 14.4682C12.7191 14.8098 11.8817 15 11 15C10.1183 15 9.28093 14.8098 8.52682 14.4682C8.00429 14.2315 7.74302 14.1131 7.59797 14.0722C7.4472 14.0297 7.35983 14.0143 7.20361 14.0026C7.05331 13.9914 6.94079 14 6.71575 14.0172C6.6237 14.0242 6.5425 14.0341 6.46558 14.048C5.23442 14.2709 4.27087 15.2344 4.04798 16.4656C4 16.7306 4 17.0485 4 17.6841V19.4C4 19.9601 4 20.2401 4.10899 20.454C4.20487 20.6422 4.35785 20.7951 4.54601 20.891C4.75992 21 5.03995 21 5.6 21H10.5M15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        הצעות מחיר
    </p>
{% endblock breadcrumbs %}

{% block content %}
    <div class="px-4 py-6 w-full flex items-center justify-between border-b border-gray-200">
        <div>
            <h1 class="font-semibold text-3xl mb-1">הצעות מחיר</h1>
            <p class="text-gray-400">זוהי רשימה של כל הצעות המחיר שלך. מכן תוכלו לארגן, לנהל ולערוך את הצעות המחיר שלכם</p>
        </div>
        <div class="">
        </div>
    </div>
    <div x-data="leadKanbanHandler()">
        <div class="p-8" >
        <!-- Action Section -->
         <div class="flex items-center justify-between">
            <form class="relative" id="leadSearch">
                <input type="text" class="input-field-search" placeholder="חפש לפי שם, מספר או מקושר" x-model="searchQuery">
                <div class="absolute text-gray-400 w-5 top-1 right-2">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 9.00006H6.2C5.0799 9.00006 4.51984 9.00006 4.09202 9.21805C3.71569 9.40979 3.40973 9.71575 3.21799 10.0921C3 10.5199 3 11.08 3 12.2001V17.8001C3 18.9202 3 19.4802 3.21799 19.908C3.40973 20.2844 3.71569 20.5903 4.09202 20.7821C4.51984 21.0001 5.07989 21.0001 6.2 21.0001H17.787C18.9071 21.0001 19.4671 21.0001 19.895 20.7821C20.2713 20.5903 20.5772 20.2844 20.769 19.908C20.987 19.4802 20.987 18.9202 20.987 17.8001V12.0001M6 15.0001H6.01M10 15H10.01M11.5189 12.8946L12.8337 12.6347C13.5432 12.4945 13.8979 12.4244 14.2287 12.2953C14.5223 12.1807 14.8013 12.0318 15.06 11.8516C15.3514 11.6487 15.607 11.393 16.1184 10.8816L21.2668 5.73321C21.9541 5.04596 21.9541 3.9317 21.2668 3.24444C20.5796 2.55719 19.4653 2.55719 18.7781 3.24445L13.5416 8.48088C13.0625 8.96004 12.8229 9.19963 12.6294 9.47121C12.4576 9.71232 12.3131 9.97174 12.1986 10.2447C12.0696 10.5522 11.9921 10.8821 11.837 11.5417L11.5189 12.8946Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </form>
            <div class="flex items-center gap-2" x-data="{MoreBtnShow : false}">
                
                <div class="btn-action relative " @click="MoreBtnShow = !MoreBtnShow" @click.outside="MoreBtnShow = false" x-show="selectedIds.length > 0">
                    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m8 10 4 4 4-4" />
                    </svg>
                   עוד פעולות
                    <div class="p-2 flex flex-col z-50 absolute top-10 border border-gray-200 shadow rounded-lg right-0 w-54 bg-white" x-show="MoreBtnShow">
                        <button class="nav-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M11 4H7.2C6.0799 4 5.51984 4 5.09202 4.21799C4.71569 4.40974 4.40973 4.7157 4.21799 5.09202C4 5.51985 4 6.0799 4 7.2V16.8C4 17.9201 4 18.4802 4.21799 18.908C4.40973 19.2843 4.71569 19.5903 5.09202 19.782C5.51984 20 6.0799 20 7.2 20H16.8C17.9201 20 18.4802 20 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C20 18.4802 20 17.9201 20 16.8V12.5M15.5 5.5L18.3284 8.32843M10.7627 10.2373L17.411 3.58902C18.192 2.80797 19.4584 2.80797 20.2394 3.58902C21.0205 4.37007 21.0205 5.6364 20.2394 6.41745L13.3774 13.2794C12.6158 14.0411 12.235 14.4219 11.8012 14.7247C11.4162 14.9936 11.0009 15.2162 10.564 15.3882C10.0717 15.582 9.54378 15.6885 8.48793 15.9016L8 16L8.04745 15.6678C8.21536 14.4925 8.29932 13.9048 8.49029 13.3561C8.65975 12.8692 8.89125 12.4063 9.17906 11.9786C9.50341 11.4966 9.92319 11.0768 10.7627 10.2373Z"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            עריכה מרובה
                        </button>
                        <button class="nav-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 18L14 18M17 15V21M7.68213 14C8.63244 14.6318 9.77319 15 10.9999 15C11.7012 15 12.3744 14.8797 13 14.6586M10.5 21H5.6C5.03995 21 4.75992 21 4.54601 20.891C4.35785 20.7951 4.20487 20.6422 4.10899 20.454C4 20.2401 4 19.9601 4 19.4V17C4 15.3431 5.34315 14 7 14H7.5M15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            שייך לרשימה
                        </button>
                        <button class="nav-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 4L12 12M20 4V8.5M20 4H15.5M19 12.5V16.8C19 17.9201 19 18.4802 18.782 18.908C18.5903 19.2843 18.2843 19.5903 17.908 19.782C17.4802 20 16.9201 20 15.8 20H7.2C6.0799 20 5.51984 20 5.09202 19.782C4.71569 19.5903 4.40973 19.2843 4.21799 18.908C4 18.4802 4 17.9201 4 16.8V8.2C4 7.0799 4 6.51984 4.21799 6.09202C4.40973 5.71569 4.71569 5.40973 5.09202 5.21799C5.51984 5 6.07989 5 7.2 5H11.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                           ייצוא
                        </button>
                        <hr class="text-gray-200 my-1">
                        <button class="nav-btn danger" @click="modelBackgroundShow = true, massDeleteModelShow = true">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 6H20M16 6L15.7294 5.18807C15.4671 4.40125 15.3359 4.00784 15.0927 3.71698C14.8779 3.46013 14.6021 3.26132 14.2905 3.13878C13.9376 3 13.523 3 12.6936 3H11.3064C10.477 3 10.0624 3 9.70951 3.13878C9.39792 3.26132 9.12208 3.46013 8.90729 3.71698C8.66405 4.00784 8.53292 4.40125 8.27064 5.18807L8 6M18 6V16.2C18 17.8802 18 18.7202 17.673 19.362C17.3854 19.9265 16.9265 20.3854 16.362 20.673C15.7202 21 14.8802 21 13.2 21H10.8C9.11984 21 8.27976 21 7.63803 20.673C7.07354 20.3854 6.6146 19.9265 6.32698 19.362C6 18.7202 6 17.8802 6 16.2V6M14 10V17M10 10V17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          מחיקה
                        </button>
                    </div>
                </div>
                <button class="btn-action">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M3 4.6C3 4.03995 3 3.75992 3.10899 3.54601C3.20487 3.35785 3.35785 3.20487 3.54601 3.10899C3.75992 3 4.03995 3 4.6 3H19.4C19.9601 3 20.2401 3 20.454 3.10899C20.6422 3.20487 20.7951 3.35785 20.891 3.54601C21 3.75992 21 4.03995 21 4.6V6.33726C21 6.58185 21 6.70414 20.9724 6.81923C20.9479 6.92127 20.9075 7.01881 20.8526 7.10828C20.7908 7.2092 20.7043 7.29568 20.5314 7.46863L14.4686 13.5314C14.2957 13.7043 14.2092 13.7908 14.1474 13.8917C14.0925 13.9812 14.0521 14.0787 14.0276 14.1808C14 14.2959 14 14.4182 14 14.6627V17L10 21V14.6627C10 14.4182 10 14.2959 9.97237 14.1808C9.94787 14.0787 9.90747 13.9812 9.85264 13.8917C9.7908 13.7908 9.70432 13.7043 9.53137 13.5314L3.46863 7.46863C3.29568 7.29568 3.2092 7.2092 3.14736 7.10828C3.09253 7.01881 3.05213 6.92127 3.02763 6.81923C3 6.70414 3 6.58185 3 6.33726V4.6Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    סינון
                </button>
                <a class="btn-action" href="{% url 'quote-list' %}">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 9.5H21M3 14.5H21M8 4.5V19.5M6.2 19.5H17.8C18.9201 19.5 19.4802 19.5 19.908 19.282C20.2843 19.0903 20.5903 18.7843 20.782 18.408C21 17.9802 21 17.4201 21 16.3V7.7C21 6.5799 21 6.01984 20.782 5.59202C20.5903 5.21569 20.2843 4.90973 19.908 4.71799C19.4802 4.5 18.9201 4.5 17.8 4.5H6.2C5.0799 4.5 4.51984 4.5 4.09202 4.71799C3.71569 4.90973 3.40973 5.21569 3.21799 5.59202C3 6.01984 3 6.57989 3 7.7V16.3C3 17.4201 3 17.9802 3.21799 18.408C3.40973 18.7843 3.71569 19.0903 4.09202 19.282C4.51984 19.5 5.07989 19.5 6.2 19.5Z" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    טבלה
                </a>
            </div>
         </div>
        <!-- Content Table -->
         {% if quotes %}
         <div class="flex mt-2 gap-4 h-150 justify-between">
            {% for s in statuses %}
            <div x-data="{compressed : false}" class="h-full w-full"> 
                <div :class="compressed ? 'w-24' : 'w-full'" class="h-full bg-gray-50 p-2 rounded-lg" x-transition.duration.500ms>
                    <div class="flex items-center justify-between border-b border-gray-200 pb-2">
                        <div class="px-4 flex items-center gap-2">
                            <h2 class="text-lg font-extralight" x-show="!compressed" :class="compressed ? 'text-gray-100 w-0' : '' " x-collapse.duration.500ms x-transition.500ms>{{s.1}}</h2>
                            <span name="status-count" class="status-pill {% if s.0 == 'draft' %}info{% elif s.0 == 'lost' %}danger{% elif s.0 == 'won' %}success{% elif s.0 == 'sent' %}proccess{% endif %}" x-text="getFilteredCount('{{s.0}}')"></span>
                        </div>
                        <div class="flex items-center justify-end gap-1" >
                            <button class="btn-ghost" @click="compressed = !compressed" >
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="size-4" x-show="!compressed">
                                    <path d="M14 10L21 3M14 10H18.5M14 10V5.5M10 14L3 21M10 14H5.5M10 14L10 18.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="size-4" x-show="compressed">
                                    <path d="M14 10L21 3M21 3H16.5M21 3V7.5M10 14L3 21M3 21H7.5M3 21L3 16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="overflow-y-auto h-full flex flex-col gap-2 mt-2 min-h-32 status-column" x-show="!compressed" id="{{s.0}}-column">
                        {% for quote in quotes %}
                        {% if quote.status == s.0 %}
                            <div class="bg-white rounded-lg p-4 border border-gray-200 flex flex-col hover:border-gray-300 cursor-grab"
                                x-data="{modeOptions : false}" 
                                data-quote-id="{{quote.id}}"
                                x-show="matchesSearch($el)"
                                data-lead-id="{{quote.id}}" 
                                data-search-name="{{quote.name}}" 
                                data-search-number="{{quote.quote_number}}" 
                                data-search-related="{{quote.related_to}}">
                                <div class="flex items-center justify-between">
                                    <span class="status-pill"># {{quote.quote_number}}</span>
                                    <div class="size-6 p-1 rounded hover:bg-gray-100 cursor-pointer relative" @click="modeOptions = !modeOptions" @click.outside="modeOptions = false">
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M18 12H18.01M12 12H12.01M6 12H6.01M13 12C13 12.5523 12.5523 13 12 13C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11C12.5523 11 13 11.4477 13 12ZM19 12C19 12.5523 18.5523 13 18 13C17.4477 13 17 12.5523 17 12C17 11.4477 17.4477 11 18 11C18.5523 11 19 11.4477 19 12ZM7 12C7 12.5523 6.55228 13 6 13C5.44772 13 5 12.5523 5 12C5 11.4477 5.44772 11 6 11C6.55228 11 7 11.4477 7 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <div class="p-2 flex flex-col z-100 absolute top-7 border border-gray-200 shadow rounded-lg -right-36 w-44 bg-white" x-show="modeOptions">
                                            <a class="nav-btn" href="{% url 'quote-detail' quote.id %}">
                                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M20 7V8.2C20 9.88016 20 10.7202 19.673 11.362C19.3854 11.9265 18.9265 12.3854 18.362 12.673C17.7202 13 16.8802 13 15.2 13H4M4 13L8 9M4 13L8 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                צפייה
                                            </a>
                                            <a class="nav-btn" href="{% url 'quote-edit' quote.id 'quote-kanban' %}">
                                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M11 4H7.2C6.0799 4 5.51984 4 5.09202 4.21799C4.71569 4.40974 4.40973 4.7157 4.21799 5.09202C4 5.51985 4 6.0799 4 7.2V16.8C4 17.9201 4 18.4802 4.21799 18.908C4.40973 19.2843 4.71569 19.5903 5.09202 19.782C5.51984 20 6.0799 20 7.2 20H16.8C17.9201 20 18.4802 20 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C20 18.4802 20 17.9201 20 16.8V12.5M15.5 5.5L18.3284 8.32843M10.7627 10.2373L17.411 3.58902C18.192 2.80797 19.4584 2.80797 20.2394 3.58902C21.0205 4.37007 21.0205 5.6364 20.2394 6.41745L13.3774 13.2794C12.6158 14.0411 12.235 14.4219 11.8012 14.7247C11.4162 14.9936 11.0009 15.2162 10.564 15.3882C10.0717 15.582 9.54378 15.6885 8.48793 15.9016L8 16L8.04745 15.6678C8.21536 14.4925 8.29932 13.9048 8.49029 13.3561C8.65975 12.8692 8.89125 12.4063 9.17906 11.9786C9.50341 11.4966 9.92319 11.0768 10.7627 10.2373Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                עריכה
                                            </a>
                                            <hr class="text-gray-200 my-1">
                                            <button class="nav-btn danger" @click="modelBackgroundShow = true, singleDeleteModelShow = true, selectedQuote = '{{quote.id}}', selectedQuoteName = '{{quote.name}}'">
                                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M4 6H20M16 6L15.7294 5.18807C15.4671 4.40125 15.3359 4.00784 15.0927 3.71698C14.8779 3.46013 14.6021 3.26132 14.2905 3.13878C13.9376 3 13.523 3 12.6936 3H11.3064C10.477 3 10.0624 3 9.70951 3.13878C9.39792 3.26132 9.12208 3.46013 8.90729 3.71698C8.66405 4.00784 8.53292 4.40125 8.27064 5.18807L8 6M18 6V16.2C18 17.8802 18 18.7202 17.673 19.362C17.3854 19.9265 16.9265 20.3854 16.362 20.673C15.7202 21 14.8802 21 13.2 21H10.8C9.11984 21 8.27976 21 7.63803 20.673C7.07354 20.3854 6.6146 19.9265 6.32698 19.362C6 18.7202 6 17.8802 6 16.2V6M14 10V17M10 10V17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                מחיקה
                                            </button>
                                        </div>
                                    </div> 
                                </div>
                                <div class="flex flex-col gap-1 my-1">
                                    <a class="font-semibold hover:text-gray-600 w-fit" href="{% url 'quote-detail' quote.id %}">{{ quote.name }}</a>
                                    <span class="rounded-lg border border-gray-200 px-1 py-0.5 text-xs w-fit text-gray-500 flex gap-1 items-center">
                                        {% if quote.content_object.logo %}
                                            <img src="{{quote.content_object.logo.url}}" alt="Customer Logo" class="h-6 w-6 squircle">
                                        {% endif %}
                                        {{ quote.related_to }}
                                    </span>
                                </div>
                                <div class="flex items-center gap-2">
                                    {% if quote.service %}
                                <div class="flex gap-1 items-center border-l border-gray-200 pl-2">
                                    <svg class="size-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12.9996 3L5.06859 12.6934C4.72703 13.1109 4.55625 13.3196 4.55471 13.4956C4.55336 13.6486 4.62218 13.7939 4.74148 13.8897C4.87867 14 5.14837 14 5.68776 14H11.9996L10.9996 21L18.9305 11.3066C19.2721 10.8891 19.4429 10.6804 19.4444 10.5044C19.4458 10.3514 19.377 10.2061 19.2577 10.1103C19.1205 10 18.8508 10 18.3114 10H11.9996L12.9996 3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <p class="text-xs"><p class="text-gray-500">שירות: </p>{{ quote.service.name }}</p>
                                </div>
                                {% endif %}
                                {% if quote.total_price %}
                                <div class="flex gap-1 items-center">
                                    <svg class="size-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M18 8.5V8.35417C18 6.50171 16.4983 5 14.6458 5H9.5C7.567 5 6 6.567 6 8.5C6 10.433 7.567 12 9.5 12H14.5C16.433 12 18 13.567 18 15.5C18 17.433 16.433 19 14.5 19H9.42708C7.53436 19 6 17.4656 6 15.5729V15.5M12 3V21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <p class="">₪{{ quote.total_price|floatformat:"0"|intcomma:False }}</p>
                                </div>
                                {% endif %}
                                </div>
                                
                                <hr class="my-2 text-gray-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <span class="flex gap-1 items-center">
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="size-4">
                                                <path d="M11 6L21 6.00072M11 12L21 12.0007M11 18L21 18.0007M3 11.9444L4.53846 13.5L8 10M3 5.94444L4.53846 7.5L8 4M4.5 18H4.51M5 18C5 18.2761 4.77614 18.5 4.5 18.5C4.22386 18.5 4 18.2761 4 18C4 17.7239 4.22386 17.5 4.5 17.5C4.77614 17.5 5 17.7239 5 18Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            <p class="text-xs text-gray-700">{{ quote.notes.all.count }}</p>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            {% endfor %}
         </div>
         
        {% else %}
        <!-- No Content Section -->
        <div class="border-dashed border-2 border-gray-200 flex flex-col items-center justify-center rounded-xl p-6 gap-4 text-center mt-2">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-24 h-24 text-gray-400 -mb-2">
                <path
                    d="M13.2686 14.2686L15 16M12.0627 6.06274L11.9373 5.93726C11.5914 5.59135 11.4184 5.4184 11.2166 5.29472C11.0376 5.18506 10.8425 5.10425 10.6385 5.05526C10.4083 5 10.1637 5 9.67452 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V15.8C3 16.9201 3 17.4802 3.21799 17.908C3.40973 18.2843 3.71569 18.5903 4.09202 18.782C4.51984 19 5.07989 19 6.2 19H17.8C18.9201 19 19.4802 19 19.908 18.782C20.2843 18.5903 20.5903 18.2843 20.782 17.908C21 17.4802 21 16.9201 21 15.8V10.2C21 9.0799 21 8.51984 20.782 8.09202C20.5903 7.71569 20.2843 7.40973 19.908 7.21799C19.4802 7 18.9201 7 17.8 7H14.3255C13.8363 7 13.5917 7 13.3615 6.94474C13.1575 6.89575 12.9624 6.81494 12.7834 6.70528C12.5816 6.5816 12.4086 6.40865 12.0627 6.06274ZM14 12.5C14 13.8807 12.8807 15 11.5 15C10.1193 15 9 13.8807 9 12.5C9 11.1193 10.1193 10 11.5 10C12.8807 10 14 11.1193 14 12.5Z"
                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="flex flex-col gap-2">
                <h3 class="text-xl font-semibold">לא קיימות הצעות מחיר במערכת עדיין</h3>
                <p class="text-gray-400">צור הצעת מחיר חדשה או ייבא הצעות מחיר מתוך קובץ <br> ניתן לעלות קבצים מסוג xlsx או csv</p>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="fixed top-0 right-0 h-screen w-screen bg-black/30 flex items-start justify-center pt-60" x-show="modelBackgroundShow" x-cloak>
        <!-- Delete Confirmation Model For Single Quote-->
        <div class="relative bg-white border border-gray-200 shadow rounded-lg px-4 py-4 min-w-1/4 min-h-1/5 flex flex-col" x-show="singleDeleteModelShow" x-cloak>
            <button class="absolute top-2 left-2 [&>svg]:size-6 p-0.5 rounded hover:bg-gray-50 cursor-pointer" @click="modelBackgroundShow = false, quoteDeleteModelShow = false">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 6L18 18M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="flex-1">
                <h1 class="text-xl font-semibold my-3">מחיקת הצעת מחיר</h1>
                <span class="flex gap-2 items-center">
                    <p class="text-gray-500">אתה עומד למחוק את</p>
                    <p class="text-gray-900 text-semibold" x-text="selectedQuoteName"></p>
                </span>
                <p class="text-gray-500">פעולה זו אינה ניתנת לשחזור</p>
            </div>
            <div class="flex items-center justify-end gap-2">
                <form method="post" :action="'{% url 'quote-delete' pk=999999 %}'.replace('999999', selectedQuote)">
                    {% csrf_token %}
                    <input type="text" name="fallback" value="quote-detail" class="hidden">
                    <button class="btn-action danger high" type="submit">
                     מחיקה
                    </button>
                </form>
                
                <button class="btn-action" @click="modelBackgroundShow = false, quoteDeleteModelShow = false">
                    ביטול
                </button>
            </div>
        </div>
<script src="{% static 'js/kanban-drag-drop.js' %}"></script>
<script>
    function leadKanbanHandler() {
        return {
            // State properties
            selectedIds: [],
            modelBackgroundShow: false,
            massDeleteModelShow: false,
            singleDeleteModelShow: false,
            selectedQuote: 0,
            selectedQuoteName: '',
            searchQuery: '',

            // Check if a card matches the search query
            matchesSearch(card) {
                // If no search query, show all cards
                if (!this.searchQuery || this.searchQuery.trim() === '') {
                    return true;
                }

                // Get search data from the card's data attributes
                const searchName = (card.dataset.searchName || '').toLowerCase();
                const searchNumber = (card.dataset.searchNumber || '').toLowerCase();
                const searchRelated = (card.dataset.searchRelated || '').toLowerCase();

                // Combine all searchable fields
                const searchableText = `${searchName} ${searchNumber} ${searchRelated}`;

                // Check if query matches any field
                const query = this.searchQuery.toLowerCase().trim();
                return searchableText.includes(query);
            },

            // Get count of filtered cards for a specific status
            getFilteredCount(status) {
                const column = document.getElementById(status + '-column');
                if (!column) return 0;

                const cards = column.querySelectorAll('[data-quote-id]');
                let count = 0;

                cards.forEach(card => {
                    if (this.matchesSearch(card)) {
                        count++;
                    }
                });

                return count;
            },

            // Get all visible row IDs
            getVisibleRowIds() {
                const rows = document.querySelectorAll('tbody tr[data-quote-id]');
                const visibleIds = [];

                rows.forEach(row => {
                    if (this.matchesSearch(row)) {
                        const quoteId = parseInt(row.dataset.quoteId);
                        visibleIds.push(quoteId);
                    }
                });

                return visibleIds;
            },

            // Toggle select all visible rows
            toggleSelectAll() {
                const visibleIds = this.getVisibleRowIds();

                // If all visible rows are selected, deselect all
                // Otherwise, select all visible rows
                const allSelected = visibleIds.every(id => this.selectedIds.includes(id));

                if (allSelected) {
                    // Deselect all visible rows
                    this.selectedIds = this.selectedIds.filter(id => !visibleIds.includes(id));
                } else {
                    // Select all visible rows (avoid duplicates)
                    const newSelectedIds = [...new Set([...this.selectedIds, ...visibleIds])];
                    this.selectedIds = newSelectedIds;
                }
            },

            // Check if all visible rows are selected
            isAllVisibleSelected() {
                const visibleIds = this.getVisibleRowIds();
                if (visibleIds.length === 0) return false;
                return visibleIds.every(id => this.selectedIds.includes(id));
            },

            // Check if some (but not all) visible rows are selected
            isSomeVisibleSelected() {
                const visibleIds = this.getVisibleRowIds();
                if (visibleIds.length === 0) return false;

                const selectedCount = visibleIds.filter(id => this.selectedIds.includes(id)).length;
                return selectedCount > 0 && selectedCount < visibleIds.length;
            }
        }
    }
</script>
{% endblock content %}